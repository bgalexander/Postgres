
-- ЗАДАНИЕ 1. Создание и наполнение базы данных

-- Жанры
INSERT INTO Genres (Genres_ID, Name) VALUES
(1, 'Rock'),
(2, 'Pop'),
(3, 'Jazz');

-- Исполнители
INSERT INTO Artist (Artist_ID, Name, Genres_ID) VALUES
(1, 'Queen', 1),
(2, 'Adele', 2),
(3, 'Miles Davis', 3),
(4, 'Muse', 1);

-- Альбомы
INSERT INTO Albums (Albums_ID, Title, Release_year, Artist_ID) VALUES
(1, 'A Night at the Opera', 1975, 1),
(2, '25', 2015, 2),
(3, 'Kind of Blue', 1959, 3);

-- Треки
INSERT INTO Tracks (Track_ID, Title, Duration, Album_ID) VALUES
(1, 'Bohemian Rhapsody', 354, 1),
(2, 'Love of My Life', 220, 1),
(3, 'Hello', 295, 2),
(4, 'When We Were Young', 298, 2),
(5, 'So What', 545, 3),
(6, 'Freddie Freeloader', 586, 3);

-- Сборники
INSERT INTO Compilations (Comp_ID, Title, Release_year) VALUES
(1, 'Rock Hits', 2018),
(2, 'Pop Anthems', 2019),
(3, 'Jazz Legends', 2020),
(4, 'Best of All Time', 2021);

-- Связи исполнителей и жанров
INSERT INTO Artist_Genres (ArtGen_ID, Artist_ID, Genres_ID) VALUES
(1, 1, 1),
(2, 2, 2),
(3, 3, 3),
(4, 4, 1);

-- Связи альбомов и исполнителей
INSERT INTO Album_Artist (AlbArt_ID, Album_ID, Artist_ID) VALUES
(1, 1, 1),
(2, 2, 2),
(3, 3, 3);

-- Связи сборников и треков
INSERT INTO Compilations_Tracks (CompTrack_ID, Comp_ID, Track_ID) VALUES
(1, 1, 1),
(2, 1, 2),
(3, 2, 3),
(4, 2, 4),
(5, 3, 5),
(6, 3, 6),
(7, 4, 1),
(8, 4, 3);

-- ЗАДАНИЕ 2. SELECT-запросы

-- 1. Название и продолжительность самого длительного трека
SELECT Title, Duration
FROM Tracks
ORDER BY Duration DESC
LIMIT 1;

-- 2. Название треков, продолжительность которых не менее 3,5 минут
SELECT Title
FROM Tracks
WHERE Duration >= 210;

-- 3. Названия сборников, вышедших в период с 2018 по 2020 год включительно
SELECT Title
FROM Compilations
WHERE Release_year BETWEEN 2018 AND 2020;

-- 4. Исполнители, чьё имя состоит из одного слова
SELECT Name
FROM Artist
WHERE Name NOT LIKE '% %';

-- 5. Название треков, которые содержат слово «мой» или «my»
SELECT Title
FROM Tracks
WHERE Title ILIKE '%мой%' OR Title ILIKE '%my%';

-- ЗАДАНИЕ 3. SELECT-запросы

-- 1. Количество исполнителей в каждом жанре
SELECT g.Name AS Genre, COUNT(ag.Artist_ID) AS Artist_Count
FROM Genres g
JOIN Artist_Genres ag ON g.Genres_ID = ag.Genres_ID
GROUP BY g.Name;

-- 2. Количество треков, вошедших в альбомы 2019–2020 годов
SELECT COUNT(t.Track_ID) AS Track_Count
FROM Tracks t
JOIN Albums a ON t.Album_ID = a.Albums_ID
WHERE a.Release_year BETWEEN 2019 AND 2020;

-- 3. Средняя продолжительность треков по каждому альбому
SELECT a.Title, AVG(t.Duration) AS Avg_Duration
FROM Albums a
JOIN Tracks t ON a.Albums_ID = t.Album_ID
GROUP BY a.Title;

-- 4. Все исполнители, которые не выпустили альбомы в 2020 году
SELECT DISTINCT ar.Name
FROM Artist ar
WHERE ar.Artist_ID NOT IN (
    SELECT DISTINCT a.Artist_ID
    FROM Albums a
    WHERE a.Release_year = 2020
);

-- 5. Названия сборников, в которых присутствует конкретный исполнитель (например: Queen)
SELECT DISTINCT c.Title
FROM Compilations c
JOIN Compilations_Tracks ct ON c.Comp_ID = ct.Comp_ID
JOIN Tracks t ON ct.Track_ID = t.Track_ID
JOIN Albums a ON t.Album_ID = a.Albums_ID
JOIN Artist ar ON a.Artist_ID = ar.Artist_ID
WHERE ar.Name = 'Queen';
